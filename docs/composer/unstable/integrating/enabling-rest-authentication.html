<!doctype html>
<html lang="en">
  
  
  

<head>
  <meta charset="utf-8">
  
    <title>Enabling authentication for the REST server | Hyperledger Composer</title>
  
  <meta name="viewport" content="width=device-width">
  <link rel="icon" type="image/x-icon" href="/api-doc/composer/unstable/favicon.ico">
  <meta name="google-site-verification" content="fBQRJ6h7MV7_TJ7grbgq4P-d-07NRfDWPe4pqEEoH5w">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  
    <!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-91314349-2', 'auto');
ga('require', 'outboundLinkTracker');
ga('require', 'eventTracker');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script async src="/api-doc/composer/unstable/assets/js/autotrack.js"></script>
<!-- End Google Analytics -->

  

  
    <link href="/api-doc/composer/unstable/assets/css/normalize.css" rel="stylesheet">
    <link href="/api-doc/composer/unstable/assets/css/new-style.min.css" rel="stylesheet">
    <link href="/api-doc/composer/unstable/assets/css/grid-layout.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>
  
</head>


<body class="">

  
  <!-- % include navbar.html % -->
  

  <div class="SiteWrapper">
    
      <div class="content">
    <article class="docs-container">
        <!-- If there's a sidebar, divide into 2 columns -->
        
        <div class="page-sidebar-grid" id="off-canvas">
          <!-- <a class="toggle close" href="#">close</a> -->
          <div class="docs-pagenav-grid">
            <!-- Navigation -->
  <nav class="navbar-docs" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
            <a class="navbar-brand" href="/api-doc/composer/unstable/index.html"><b>Hyperledger</b> Composer</a>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <div class="top-nav-docs">
                <!-- <li>
                    <a href="services.html">Composer</a>
                </li> -->
                <!-- <li>
                    <a href="https://composer-playground.mybluemix.net/">Playground</a>
                </li> -->
                    <a href="../tutorials/tutorials.html">Tutorials</a>
                    <a href="../introduction/introduction.html">Docs</a>
                    <a href="../support/support-index.html">Community</a>
            </div>
        </div>
</nav>

          </div>

          <div class="docs-current-page-grid">
          <p>Enabling authentication for the REST server</p>
          </div>

          <nav class="context-nav">
            
            
              <ul>
<li><p><a href="../introduction/introduction.html">Introduction</a></p>

<ul>
<li><a href="../introduction/key-concepts.html">Key Concepts</a></li>
<li><a href="../introduction/solution-architecture.html">Typical Solution Architecture</a></li>
</ul></li>
<li><p><a href="../installing/installing-index.html">Installing</a></p>

<ul>
<li><a href="../installing/getting-started-with-playground.html">Using the Playground online</a></li>
<li><a href="../installing/prereqs-mac.html">Installing pre-requisites on Mac OS</a></li>
<li><a href="../installing/using-playground-locally.html">Installing the Playground locally</a></li>
<li><a href="../installing/development-tools.html">Installing a development environment</a></li>
</ul></li>
<li><p><a href="../tutorials/tutorials.html">Tutorials</a></p>

<ul>
<li><a href="../tutorials/playground-guide.html">Playground Tutorial</a></li>
<li><a href="../tutorials/developer-guide.html">Developer Guide</a></li>
<li><a href="../tutorials/queries.html">Queries Guide</a></li>
</ul></li>
<li><p><a href="../playground/playground-index.html">Using Playground</a></p>

<ul>
<li><a href="../playground/id-cards-playground.html">ID Cards</a></li>
</ul></li>
<li><p><a href="../business-network/business-network-index.html">Developing Business Networks</a></p>

<ul>
<li><a href="../business-network/businessnetworkdefinition.html">Business Network Definitions</a></li>
<li><a href="../business-network/bnd-create.html">Create a Business Network Definition</a></li>
<li><a href="../business-network/bnd-deploy.html">Deploying and Updating Business Networks</a></li>
<li><a href="../business-network/publishing-events.html">Emitting Events</a></li>
<li><a href="../business-network/testing.html">Testing Business Networks</a></li>
<li><a href="../business-network/bnd-publish.html">Publish Models or Business Network Definitions</a></li>
<li><a href="../business-network/query.html">Querying Business Network Data</a></li>
<li><a href="../business-network/programmatic-access-control.html">Programmatic access control</a></li>
<li><a href="../business-network/historian.html">Hyperledger Composer Historian</a></li>
</ul></li>
<li><p><a href="../applications/applications-index.html">Developing Applications</a></p>

<ul>
<li><a href="../applications/node.html">Writing a Node.js application</a></li>
<li><a href="../applications/web.html">Writing Web or mobile applications</a></li>
<li><a href="../applications/subscribing-to-events.html">Subscribing to events</a></li>
</ul></li>
<li><p><a href="../integrating/integrating-index.html">Integrating Existing Systems</a></p>

<ul>
<li><a href="../integrating/getting-started-rest-api.html">Generating a REST API</a></li>
<li><a href="../integrating/publishing-events.html">Publishing events from the REST server</a></li>
<li><a href="../integrating/enabling-rest-authentication.html">Enabling authentication for the REST server</a></li>
<li><a href="../integrating/enabling-multiuser.html">Enabling multiple user mode for the REST server</a></li>
<li><a href="../integrating/securing-the-rest-server.html">Securing the REST server using HTTPS and TLS</a></li>
<li><a href="../integrating/deploying-the-rest-server.html">Deploying the REST server for a business network</a></li>
<li><a href="../integrating/node-red.html">Integrating with Node-RED</a></li>
<li><a href="../integrating/call-out.html">Calling external REST services</a></li>
</ul></li>
<li><p><a href="../managing/managingindex.html">Managing a Deployed Business Network</a></p>

<ul>
<li><a href="../managing/participantsandidentities.html">Participants and identities</a></li>
<li><a href="../managing/participant-add.html">Adding participants</a></li>
<li><a href="../managing/id-cards-playground.html">Creating, Exporting, and Importing ID Cards</a></li>
<li><a href="../managing/identity-issue.html">Issuing a new identity to a participant</a></li>
<li><a href="../managing/identity-bind.html">Binding an existing identity to a participant</a></li>
<li><a href="../managing/identity-list.html">Listing all identities in a business network</a></li>
<li><a href="../managing/identity-revoke.html">Revoking an identity from a participant</a></li>
<li><a href="../managing/updating-composer.html">Updating the Hyperledger Composer Runtime</a></li>
</ul></li>
<li><p><a href="../problems/diagnostics.html">Diagnosing Problems</a></p>

<ul>
<li><a href="../problems/deployment-local-playground.html">Error using the local Playground</a></li>
</ul></li>
<li><p><a href="../reference/reference-index.html">Reference</a></p>

<ul>
<li><a href="../reference/MeetTheModules.html">Hyperledger Composer npm Modules</a></li>
<li><a href="../reference/cto_language.html">Modeling Language</a></li>
<li><a href="../reference/acl_language.html">Access Control Language</a></li>
<li><a href="../reference/query-language.html">Query Language</a></li>
<li><a href="../reference/model-compatibility.html">Model Compatibility</a></li>
<li><a href="../reference/connectionprofile.html">Connection Profiles</a></li>
<li><a href="../reference/js_scripts.html">Transaction Processor Functions</a></li>
<li><a href="../reference/commands.html">Hyperledger Composer CLI Commands</a></li>
<li><a href="../reference/glossary.html">Hyperledger Composer Glossary of Terms</a></li>
</ul></li>
<li><p><a href="../support/support-index.html">Support</a></p></li>
<li><p><a href="../api-doc/api-doc-index.html">API Reference</a></p>

<ul>
<li><a href="../api-doc/businessnetworkconnection.html">businessnetworkconnection (Client API)</a></li>
<li><a href="../api-doc/historian.html">historian (Client API)</a></li>
<li><a href="../api-doc/identityregistry.html">identityregistry (Client API)</a></li>
<li><a href="../api-doc/registry.html">registry (Client API)</a></li>
<li><a href="../api-doc/transactionregistry.html">transactionregistry (Client API)</a></li>
<li><a href="../api-doc/adminconnection.html">adminconnection (Admin API)</a></li>
<li><a href="../api-doc/assetregistry.html">assetregistry (Runtime API)</a></li>
<li><a href="../api-doc/participantregistry.html">participantregistry (Runtime API)</a></li>
<li><a href="../api-doc/query.html">query (Runtime API)</a></li>
<li><a href="../api-doc/businessnetworkdefinition.html">businessnetworkdefinition (Common API)</a></li>
<li><a href="../api-doc/businessnetworkmetadata.html">businessnetworkmetadata (Common API)</a></li>
<li><a href="../api-doc/concept.html">concept (Common API)</a></li>
<li><a href="../api-doc/factory.html">factory (Common API)</a></li>
<li><a href="../api-doc/idcard.html">idcard (Common API)</a></li>
<li><a href="../api-doc/identifiable.html">identifiable (Common API)</a></li>
<li><a href="../api-doc/illegalmodelexception.html">illegalmodelexception (Common API)</a></li>
<li><a href="../api-doc/introspector.html">introspector (Common API)</a></li>
<li><a href="../api-doc/invalidqueryexception.html">invalidqueryexception (Common API)</a></li>
<li><a href="../api-doc/parseexception.html">parseexception (Common API)</a></li>
<li><a href="../api-doc/relationship.html">relationship (Common API)</a></li>
<li><a href="../api-doc/resource.html">resource (Common API)</a></li>
<li><a href="../api-doc/securitycontext.html">securitycontext (Common API)</a></li>
<li><a href="../api-doc/securityexception.html">securityexception (Common API)</a></li>
<li><a href="../api-doc/serializer.html">serializer (Common API)</a></li>
<li><a href="../api-doc/typed.html">typed (Common API)</a></li>
<li><a href="../api-doc/typenotfoundexception.html">typenotfoundexception (Common API)</a></li>
<li><a href="../api-doc/validatedconcept.html">validatedconcept (Common API)</a></li>
<li><a href="../api-doc/validatedresource.html">validatedresource (Common API)</a></li>
<li><a href="../api-doc/validationexception.html">validationexception (Common API)</a></li>
</ul></li>
</ul>

            
                <div class="docs-footer-grid">
                <div class="footer-bg-break docs-footer-break">
<div class="footer-container-break">
    <div class="footer-left-break">
      <p>Released under the Apache License v2.0</p>
    </div>
  <div class="footer-right-break">
    <ul>
      <li><a href="https://github.com/hyperledger/composer">GitHub</a></li>
      <!-- <li><a href="https://github.com/hyperledger/composer/LICENSE.txt">Legal</a></li> -->
      <li><a href="/api-doc/composer/unstable/jsdoc/index.html">APIs</a></li>
      <li><a href="http://stackoverflow.com/questions/tagged/fabric-composer">Stack Overflow</a></li>
      <li><a href="https://goo.gl/forms/7YPMLP2LTN2hjIRk2">Feedback?</a></li>
    </ul>
  </div>
</div>
</div>

                </div>
          </nav>
        </div>
        <div class="page-content-grid">
          <section class="content-chunk">
            <!-- <a class="toggle open" href="#nav">open</a> -->
            
              <h1 id="enabling-authentication-for-the-rest-server">Enabling authentication for the REST server</h1>

<hr>

<p>The REST server can be configured to authenticate clients. When this option is enabled, clients must authenticate to the REST server before they are permitted to call the REST API.</p>

<h2 id="selecting-an-authentication-strategy">Selecting an authentication strategy</h2>

<p>The REST server uses the open source <a href="http://passportjs.org">Passport</a> authentication middleware. Administrators of the REST server must select Passport strategies to authenticate clients. Multiple Passport strategies can be selected, allowing clients of the REST server to select a preferred authentication mechanism. Passport includes a wide range of strategies (300+ at the time of writing), including a mix of social media (Google, Facebook, Twitter) and enterprise (SAML, LDAP) strategies.</p>

<p>The rest of this document will demonstrate how to use the <code>passport-github</code> strategy to authenticate users using their GitHub ID. Install the <code>passport-github</code> strategy by executing the following command:</p>
<div class="highlight"><pre><code class="language-" data-lang="">npm install -g passport-github
</code></pre></div>
<h2 id="configuring-the-rest-server-to-use-an-authentication-strategy">Configuring the REST server to use an authentication strategy</h2>

<p>The REST server must be configured with a list of Passport strategies to use before REST API authentication can be enabled. This configuration includes both the names of the strategies to use and the individual configuration for each strategy.</p>

<p>In order to configure the <code>passport-github</code> strategy, we will need to register an OAuth application on GitHub and retrieve the client ID and client secret. Follow these steps to register an OAuth application on GitHub:</p>

<ol>
<li>Navigate to <a href="https://github.com">GitHub</a> and log in with your user ID and password.</li>
<li>Click on your profile picture on the top right, and click on <strong>Settings</strong> from the drop down menu.</li>
<li>Click on <strong>OAuth applications</strong> under <strong>Developer settings</strong> on the left hand bar.</li>
<li>Click on <strong>Register a new application</strong>.</li>
<li>Specify the following settings:

<ul>
<li>Application name: Composer</li>
<li>Homepage: <a href="http://localhost:3000/">http://localhost:3000/</a></li>
<li>Application description: OAuth application for Composer</li>
<li>Authorization callback URL: <a href="http://localhost:3000/auth/github/callback">http://localhost:3000/auth/github/callback</a></li>
</ul></li>
<li>Click on <strong>Register application</strong>.</li>
<li>Note down the values for <strong>Client ID</strong> and <strong>Client Secret</strong>.</li>
</ol>

<p>The configuration for the REST server should be specified using the environment variable <code>COMPOSER_PROVIDERS</code>. Set the configuration for the REST server by replacing the values of <code>REPLACE_WITH_CLIENT_ID</code> and <code>REPLACE_WITH_CLIENT_SECRET</code> with the values retrieved from step 7, and executing the following command:</p>
<div class="highlight"><pre><code class="language-" data-lang="">export COMPOSER_PROVIDERS='{
  "github": {
    "provider": "github",
    "module": "passport-github",
    "clientID": "REPLACE_WITH_CLIENT_ID",
    "clientSecret": "REPLACE_WITH_CLIENT_SECRET",
    "authPath": "/auth/github",
    "callbackURL": "/auth/github/callback",
    "successRedirect": "/",
    "failureRedirect": "/"
  }
}'
</code></pre></div>
<h2 id="starting-the-rest-server-with-rest-api-authentication-enabled">Starting the REST server with REST API authentication enabled</h2>

<p>Once the environment variable <code>COMPOSER_PROVIDERS</code> has been set, you can use the <code>-a true</code> argument to start the REST server with authentication enabled. Once authentication is enabled, clients will have to authenticate before they can make any requests to the business network.</p>

<p>For example, here is the command for the business network that is deployed as part of the Developer Tutorial, however you may need to modify the command for your business network:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer-rest-server -p hlfv1 -n my-network -i admin -s adminpw -a true
</code></pre></div>
<p>Now, navigate to the REST API explorer at <a href="http://localhost:3000/explorer/">http://localhost:3000/explorer/</a>. If authentication has been successfully enabled, any attempts to call one of the business network REST API operations using the REST API explorer should be rejected with an <code>HTTP 401 Authorization Required</code> message.</p>

<h2 id="authenticating-to-the-rest-server-using-a-web-browser">Authenticating to the REST server using a web browser</h2>

<p>This step is dependent on the configuration and behaviour of the Passport strategies being used by the REST server.</p>

<ol>
<li>Authenticate to the REST server by navigating to the value of the <code>authPath</code> property specified in the environment variable <code>COMPOSER_PROVIDERS</code>. In the example above, this is <a href="http://localhost:3000/auth/github">http://localhost:3000/auth/github</a>.</li>
<li>The REST server will redirect you to GitHub to perform the OAuth web server authentication flow. GitHub will ask you if you want to authorize the Composer application to access your account. Click the <strong>Authorize</strong> button.</li>
<li>If successful, GitHub will redirect you back to the REST server.</li>
</ol>

<p>Now, navigate to the REST API explorer at <a href="http://localhost:3000/explorer/">http://localhost:3000/explorer/</a>. Attempt to call one of the business network REST API operations again using the REST API explorer. This time, the calls should succeed.</p>

<h2 id="authenticating-to-the-rest-server-using-an-http-or-rest-client">Authenticating to the REST server using an HTTP or REST client</h2>

<p>When a user authenticates to the REST server, a unique access token is generated and assigned to the authenticated user. When the user authenticates using a web browser, the access token is stored in a cookie in the local storage of the users web browser. When the authenticated user makes a subsequent request, the access token is retrieved from the cookie, and the access token is validated instead of reauthenticating the user.</p>

<p>The access token can be used to authenticate any HTTP or REST client that wishes to call the REST server. This is required when the HTTP or REST client cannot perform the authentication flow required by the configured Passport strategy. For example, all OAuth2 web authentication flows require the use of a web browser to navigate to the authentication providers website.</p>

<p>In order to use the access token, the access token must first be retrieved using a web browser. When you authenticate to the REST server, the REST API explorer at <a href="http://localhost:3000/explorer/">http://localhost:3000/explorer/</a> will show the access token at the top of the page. By default the access token is hidden, but it can be displayed by clicking the <code>Show</code> button. The access token is a long alphanumeric string, for example: <code>e9M3CLDEEj8SDq0Bx1tkYAZucOTWbgdiWQGLnOxCe7K9GhTruqlet1h5jsw10YjJ</code></p>

<p>Once the access token has been retrieved, the access token can be passed into any HTTP or REST request to authenticate the HTTP or REST client. There are two options for passing the access token - using either a query string parameter, or an HTTP header. For both of the following examples, replace the string <code>xxxxx</code> with the value of the access token.</p>

<p>Query string - add the <code>access_token</code> query string parameter to all HTTP or REST requests:</p>
<div class="highlight"><pre><code class="language-" data-lang="">curl -v http://localhost:3000/api/system/ping?access_token=xxxxx
</code></pre></div>
<p>HTTP header - add the <code>X-Access-Token</code> header to all HTTP or REST requests:</p>
<div class="highlight"><pre><code class="language-" data-lang="">curl -v -H 'X-Access-Token: xxxxx' http://localhost:3000/api/system/ping
</code></pre></div>
<p>=======</p>

            
          </section>
        </div>
        <!-- Otherwise, have the main content fill all 12 columns... -->
        
      <div class="PageNavigation">
    
    
  </div>
    </article>
</div>
<script>
(function (document) {
    function clipboard_init() {
        var charts = document.querySelectorAll("div.highlight"),
            arr = [],
            i, j, maxItem, pre, btn, el;

        // Make sure we are dealing with an array
        for(i = 0, maxItem = charts.length; i < maxItem; i++) arr.push(charts[i]);

        // Find the UML source element and get the text
        for (i = 0, maxItem = arr.length; i < maxItem; i++) {
            el = arr[i];
            pre = el.childNodes[0];

            pre.id = "hl_code" + i.toString();
            btn = document.createElement('copy-button');
            btn.appendChild(document.createTextNode('Copy'));
            btn.setAttribute("class", "copy-btn");
            btn.setAttribute("data-clipboard-target", "#hl_code" + i.toString());
            el.insertBefore(btn, pre);
        }
        new Clipboard('.copy-btn');
    };

    function onReady(fn) {
        if (document.addEventListener) {
            document.addEventListener('DOMContentLoaded', fn);
        } else {
            document.attachEvent('onreadystatechange', function() {
                if (document.readyState === 'interactive')
                    fn();
            });
        }
    }

    onReady(function(){
        clipboard_init();
    });
})(document);
</script>
<script src="/api-doc/composer/unstable/assets/js/nav.js"></script>

    

    


  </div>
</body>
</html>
